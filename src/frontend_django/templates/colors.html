{% extends 'base.html' %}

{% block title %}Colors - Clone Hero Manager{% endblock %}

{% block content %}
<div class="container">
    <h1>üé® Color Profile Manager</h1>
    
    <div class="upload-section">
        <h2>Upload Color Profile</h2>
        <form id="colorUploadForm" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label>Upload a color profile (.ini) or an archive (.zip/.rar) with multiple .ini files</label>
                <input type="file" name="file" accept=".ini,.zip,.rar" required>
            </div>
            <button type="submit" class="btn btn-primary">Upload Color Profile</button>
        </form>
        <div id="uploadStatus" class="status-message" style="display:none;"></div>
    </div>
    
    <div class="profiles-section">
        <h2>üìÇ Existing Color Profiles</h2>
        <ul class="file-list">
            {% for profile in color_profiles %}
            <li>
                <code>{{ profile }}</code>
                <button class="btn btn-danger btn-sm delete-profile" data-profile="{{ profile }}">üóëÔ∏è Delete</button>
            </li>
            {% empty %}
            <li>No color profiles found.</li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/upload.js' %}"></script>
<script>
setupUploadForm('colorUploadForm', '{% url "content:colors" %}', 'uploadStatus');

document.querySelectorAll('.delete-profile').forEach(btn => {
    btn.addEventListener('click', async function() {
        if (!confirm('Delete this color profile?')) return;
        
        const profile = this.getAttribute('data-profile');
        try {
            const response = await fetch(`/colors/${encodeURIComponent(profile)}/delete/`, {
                method: 'POST',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
            });
            
            const result = await response.json();
            if (result.success) {
                this.closest('li').remove();
            } else {
                alert(`Error: ${result.error}`);
            }
        } catch (error) {
            alert(`Error: ${error.message}`);
        }
    });
});
</script>
{% endblock %}
