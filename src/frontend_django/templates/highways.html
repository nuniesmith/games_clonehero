{% extends 'base.html' %}

{% block title %}Highways - Clone Hero Manager{% endblock %}

{% block content %}
<div class="container">
    <h1>üõ£Ô∏è Highway Manager</h1>
    <p>Upload and manage highways for Clone Hero! Highways are visual elements used in the game background during gameplay, enhancing the playing experience.</p>
    
    <!-- Tabs -->
    <div class="tabs">
        <button class="tab-btn active" data-tab="image">üñºÔ∏è Image Highways</button>
        <button class="tab-btn" data-tab="video">üé• Video Highways</button>
    </div>
    
    <!-- Image Highways Tab -->
    <div id="image-tab" class="tab-content active">
        <h2>Image Highways</h2>
        <form id="imageUploadForm" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="hw_type" value="image_highways">
            <div class="form-group">
                <input type="file" name="file" accept=".png,.jpg,.jpeg,.zip,.rar" required>
            </div>
            <button type="submit" class="btn btn-primary">Upload Image Highway</button>
        </form>
        <div id="imageStatus" class="status-message" style="display:none;"></div>
        
        <h3>üìÇ Existing Image Highways</h3>
        <ul class="file-list">
            {% for hw in image_highways %}
            <li>
                <code>{{ hw }}</code>
                <button class="btn btn-danger btn-sm delete-highway" data-type="image_highways" data-name="{{ hw }}">üóëÔ∏è Delete</button>
            </li>
            {% empty %}
            <li>No image highways found.</li>
            {% endfor %}
        </ul>
    </div>
    
    <!-- Video Highways Tab -->
    <div id="video-tab" class="tab-content">
        <h2>Video Highways</h2>
        <form id="videoUploadForm" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="hw_type" value="video_highways">
            <div class="form-group">
                <input type="file" name="file" accept=".webm,.zip,.rar" required>
            </div>
            <button type="submit" class="btn btn-primary">Upload Video Highway</button>
        </form>
        <div id="videoStatus" class="status-message" style="display:none;"></div>
        
        <h3>üìÇ Existing Video Highways</h3>
        <ul class="file-list">
            {% for hw in video_highways %}
            <li>
                <code>{{ hw }}</code>
                <button class="btn btn-danger btn-sm delete-highway" data-type="video_highways" data-name="{{ hw }}">üóëÔ∏è Delete</button>
            </li>
            {% empty %}
            <li>No video highways found.</li>
            {% endfor %}
        </ul>
    </div>
    
    <div class="info-section">
        <h2>üìñ How It Works</h2>
        <h3>Step-by-Step Guide</h3>
        <ol>
            <li><strong>Choose a Highway Type</strong>
                <ul>
                    <li><strong>Image Highways:</strong> Upload PNG, JPG, JPEG, ZIP, RAR</li>
                    <li><strong>Video Highways:</strong> Upload WEBM, ZIP, RAR (videos must be .webm format)</li>
                </ul>
            </li>
            <li><strong>Upload Your Highway</strong> - The system will store the highway and make it available for use</li>
            <li><strong>Manage and Delete Highways</strong> - View your uploaded highways and delete old ones with a single click</li>
        </ol>
        
        <h3>üîç Features</h3>
        <ul>
            <li>‚úÖ Supports Both Image & Video Highways</li>
            <li>‚úÖ Batch Upload via ZIP/RAR for multiple highways at once</li>
            <li>‚úÖ Easy Management - Delete and update highways quickly</li>
        </ul>
        
        <h3>üéÆ Why Use Custom Highways?</h3>
        <ul>
            <li>Personalize your game experience with unique backgrounds</li>
            <li>Match themes and colors to your favorite songs</li>
            <li>Create high-contrast visuals for better note visibility</li>
        </ul>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/tabs.js' %}"></script>
<script src="{% static 'js/upload.js' %}"></script>
<script>
setupUploadForm('imageUploadForm', '{% url "content:highways" %}', 'imageStatus');
setupUploadForm('videoUploadForm', '{% url "content:highways" %}', 'videoStatus');

document.querySelectorAll('.delete-highway').forEach(btn => {
    btn.addEventListener('click', async function() {
        if (!confirm('Delete this highway?')) return;
        
        const hwType = this.getAttribute('data-type');
        const hwName = this.getAttribute('data-name');
        try {
            const response = await fetch(`/highways/${hwType}/${encodeURIComponent(hwName)}/delete/`, {
                method: 'POST',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
            });
            
            const result = await response.json();
            if (result.success) {
                this.closest('li').remove();
            } else {
                alert(`Error: ${result.error}`);
            }
        } catch (error) {
            alert(`Error: ${error.message}`);
        }
    });
});
</script>
{% endblock %}
